---
title: "Deployment and Branching Strategy"
description: "Comprehensive guide to deployment and branching strategy using GitHub Flow, covering Vercel and Google Cloud deployment targets."
---

This document outlines the comprehensive deployment and branching strategy for all systems in the Vencura monorepo, covering GitHub Flow, deployment targets (Vercel and Google Cloud), and hybrid deployment options.

## Overview

The Vencura monorepo uses **GitHub Flow** with `develop` as the primary development branch. All systems (API, Web, Mathler) follow a consistent deployment strategy:

- **Current Deployment**: All systems are deployed to **Vercel** (no-lock approach)
- **Future Option**: Google Cloud with Pulumi - documented but not implemented (see [Google Cloud](/docs/google-cloud) for details)

## Branching Strategy: GitHub Flow

### Branch Structure

We use **GitHub Flow** with `develop` as the main development branch:

<Diagram caption="GitHub Flow Branch Structure">
  <div className="flex flex-col gap-3 p-4 text-left">
    <div className="rounded-lg border-2 border-primary bg-primary/10 p-4 text-center font-semibold">
      main (production)
    </div>
    <div className="text-center text-muted-foreground">↑ merge</div>
    <div className="rounded-lg border-2 border-primary bg-primary/10 p-4 text-center font-semibold">
      develop (staging/development)
    </div>
    <div className="text-center text-muted-foreground">↑ merge</div>
    <div className="grid grid-cols-1 gap-2 md:grid-cols-3">
      <div className="rounded-lg border border-border bg-background p-3 text-center text-sm">
        feature/*
      </div>
      <div className="rounded-lg border border-border bg-background p-3 text-center text-sm">
        fix/*
      </div>
      <div className="rounded-lg border border-border bg-background p-3 text-center text-sm">
        chore/*
      </div>
    </div>
  </div>
</Diagram>

### Main Branches

#### `develop` - Primary Development Branch

- **Purpose**: Main development branch, serves as the staging environment
- **Deployment**: Auto-deploys to Vercel Preview (staging environment)
- **Environment**: Staging/testnet configuration
- **Protection**: Should be kept stable and deployable
- **Merges**: Feature branches merge here first for testing

#### `main` - Production Branch

- **Purpose**: Production-ready code
- **Deployment**: Auto-deploys to Vercel Production (production environment)
- **Environment**: Production/mainnet configuration
- **Protection**: Protected branch (requires PR review)
- **Merges**: Only from `develop` or hotfix branches

### Branch Types

#### Feature Branches (`feature/*`)

- **Created from**: `develop`
- **Purpose**: New features and enhancements
- **Workflow**:
  1. Create from `develop`: `git checkout develop && git checkout -b feature/my-feature`
  2. Develop and test locally
  3. Push to GitHub (creates Vercel Preview deployment)
  4. Open PR targeting `develop`
  5. After review, merge to `develop`
  6. After validation on staging, merge `develop` to `main`

#### Fix Branches (`fix/*`)

- **Created from**: `develop` (for non-critical fixes) or `main` (for critical fixes)
- **Purpose**: Bug fixes
- **Workflow**: Same as feature branches

#### Hotfix Branches (`hotfix/*`)

- **Created from**: `main`
- **Purpose**: Critical production fixes that need immediate deployment
- **Workflow**:
  1. Create from `main`: `git checkout main && git checkout -b hotfix/critical-fix`
  2. Fix and test locally
  3. Merge to `main` first (for immediate production deployment)
  4. Merge to `develop` to keep branches in sync
  5. Delete hotfix branch after merge

#### Chore Branches (`chore/*`)

- **Created from**: `develop`
- **Purpose**: Maintenance tasks, dependencies, documentation
- **Workflow**: Same as feature branches

## Deployment Strategy

### Current Deployment: Vercel

**All systems are currently deployed to Vercel** using a no-lock approach:

- ✅ **No vendor lock-in**: Code remains portable and platform-agnostic
- ✅ **Framework Defined Infrastructure (FDI)**: Uses open frameworks (Next.js, Elysia) without proprietary APIs
- ✅ **Zero-configuration CI/CD**: Git push = automatic deployment
- ✅ **Preview deployments**: Every PR gets instant production-like preview URL
- ✅ **Global distribution**: 100+ edge locations, automatic CDN, edge functions
- ✅ **Monorepo support**: Automatic project detection, no manual configuration

See [Vercel Portability Strategy](/docs/vercel-portability) for detailed portability approach.

### Deployment Targets

#### Vercel Deployments

**All applications** (`apps/api`, `apps/web`, `apps/mathler`) are configured for Vercel deployment:

<ComparisonTable
  headers={['Application', 'Production URL', 'Staging URL', 'Branch Mapping']}
  rows={[
    {
      label: 'API (apps/api)',
      values: [
        'vencura-api.vercel.app',
        'vencura-api-git-develop.vercel.app',
        'main → Production, develop → Preview',
      ],
    },
    {
      label: 'Web (apps/web)',
      values: [
        'vencura-web.vercel.app',
        'vencura-web-git-develop.vercel.app',
        'main → Production, develop → Preview',
      ],
    },
    {
      label: 'Mathler (apps/mathler)',
      values: [
        'vencura-mathler.vercel.app',
        'vencura-mathler-git-develop.vercel.app',
        'main → Production, develop → Preview',
      ],
    },
  ]}
  caption="Vercel deployment URLs and branch mappings for each application"
/>

**Configuration**: Each app has a `vercel.json` file that configures:

- Build commands (monorepo-aware)
- Output directories
- Framework detection
- Git branch deployment settings

#### Google Cloud Deployments (Pulumi)

**Documented but not implemented** - Alternative deployment option using Pulumi infrastructure-as-code:

- **Location**: `infra/vencura/` directory
- **Stack**: Pulumi TypeScript infrastructure
- **Target**: Google Cloud Run with Cloud SQL Postgres
- **Environments**: `dev` and `prod` stacks
- **Status**: Documented as future option, not currently implemented

**When to Consider** (future production security requirements):

- Production workloads requiring strict data governance
- Enhanced security requirements (HSM-backed keys, private networking)
- Regulatory/compliance requirements
- Need for MPC/threshold signing workflows

See [Google Cloud Deployment](/docs/google-cloud) for detailed documentation.

### Hybrid Deployment Option

**Documented but not implemented** - Future option for production security requirements - split architecture:

**Current Status**: Everything stays on Vercel for demo/development phase. This split architecture is documented as a potential future option ONLY if production security requirements demand it.

See [Google Cloud Deployment](/docs/google-cloud) for details on the potential split architecture with UI/API on Vercel and key-custody on Google Cloud.

## Environment Mapping

<ComparisonTable
  headers={['Branch', 'Environment', 'Blockchain Network', 'Deployment Target', 'Vercel Environment']}
  rows={[
    {
      label: 'main',
      values: [
        'Production',
        'Mainnet (real chains)',
        'Vercel Production',
        'Production',
      ],
    },
    {
      label: 'develop',
      values: [
        'Staging',
        'Testnets (Sepolia, Arbitrum Sepolia)',
        'Vercel Preview',
        'Preview',
      ],
    },
    {
      label: 'Feature branches',
      values: [
        'Development',
        'Local Anvil (dev) or Testnets (preview)',
        'Vercel Preview',
        'Preview',
      ],
    },
  ]}
  caption="Branch to environment mapping for deployment and blockchain networks"
/>

## Best Practices

### Branching

1. ✅ **Always branch from `develop`** for new features (except hotfixes)
2. ✅ **Keep `develop` stable** - it's the staging environment
3. ✅ **Never push directly to `main`** - use PRs
4. ✅ **Use descriptive branch names**: `feature/description`, `fix/description`, `hotfix/description`
5. ✅ **Merge hotfixes to both `main` and `develop`** to keep branches in sync
6. ✅ **Delete feature branches** after merging

### Deployment

1. ✅ **Test locally first** with `bun run dev:local`
2. ✅ **Validate on staging** (`develop` branch) before production
3. ✅ **Monitor deployments** in Vercel dashboard or GitHub Actions
4. ✅ **Use preview deployments** for PR validation
5. ✅ **Keep environment variables in sync** across environments
6. ✅ **Document deployment changes** in PR descriptions

