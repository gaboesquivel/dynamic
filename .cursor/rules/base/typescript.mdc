---
description: TypeScript coding standards and best practices
globs: *.tsx,*.ts
alwaysApply: false
---

# TypeScript Rules

## Core Principles
- Prefer interfaces over types for object definitions
  - **Exception**: Union types, utility types (e.g., `z.infer<typeof schema>`), and mapped types use `type`
- Avoid enums; use maps or union types instead
- Use descriptive variable names with auxiliary verbs (e.g., `isLoading`, `hasError`)
- Follow RORO pattern for function arguments **only when there are multiple parameters**; single-parameter functions use direct parameters
- Use lowercase-with-dashes for directories (e.g., `components/auth-wizard`)
- Favor named exports (exception: Next.js pages/layouts require default exports)
- Use functional & declarative programming patterns; avoid classes
- Infer types and keep them inline unless you need to reuse them

## Framework Exceptions
- **Next.js**: Pages (`app/**/page.tsx`) and layouts (`app/**/layout.tsx`) require default exports
- **Elysia**: Fully functional, no classes or decorators required

## Code Style
- **Single-line if statements without brackets**: `if (!value) return null` ✅
- **Single-line arrow functions without brackets**: `const double = (x: number) => x * 2` ✅
- Always use the least amount of chars possible while maintaining simplicity
- Prefer one-liners for simple conditional logic
- Avoid unnecessary curly braces in conditionals
- CRITICAL: Always follow eslint rules when generating code

## Modularization and Code Reuse
- **@vencura/lib**: Use for shared utilities (error handling: `getErrorMessage`, `formatZodError`; async: `delay`, `fetchWithTimeout`; env: `getEnvHelper`, `validateEnvOrThrow`; zod: `parseJsonWithSchema`, `isZodError`)
- **zod**: Always use for schema validation and type inference (`z.infer<typeof schema>`)
- **lodash**: Use for array/object operations (`isEmpty`, `uniq`, `groupBy`, `merge`, `pick`), type checking (`isPlainObject`, `isString`, `isArray`), functional utilities (`debounce`, `throttle`)
- Prefer importing types from `@vencura/core` over `@vencura/types` when types are re-exported
- Schema imports should use `@vencura/types/schemas` (schemas not re-exported from `@vencura/core`)

## ts-reset Type Safety
This monorepo uses `@total-typescript/ts-reset` configured globally via `config/typescript/reset.d.ts`. All TypeScript configurations extending workspace configs automatically include these enhanced types.

**Reference**: See [ts-reset documentation](https://www.totaltypescript.com/ts-reset) for complete details.

## Type Safety Model: Zod-First, Boundary-Driven Validation
**Zod-first type-safety strategy** - validate data at runtime boundaries, use TypeScript inference internally.

The following TypeScript ESLint "unsafe" rules are intentionally disabled globally:
- `@typescript-eslint/no-unsafe-assignment`
- `@typescript-eslint/no-unsafe-call`
- `@typescript-eslint/no-unsafe-member-access`
- `@typescript-eslint/no-unsafe-return`
- `@typescript-eslint/no-unsafe-argument`

**Reason**: These rules generate excessive noise with real-world SDKs/APIs, and the project validates untrusted data at runtime using Zod, making static checks redundant.

## Error Handling
- Fail fast: Handle errors early using guard clauses & early returns
- Place the happy path last for improved readability
- Avoid unnecessary else statements; prefer `if-return` pattern
- **Zod-based validation functions**: Functions returning result objects (e.g., `{ valid: boolean; error?: string }`) must catch all errors and return consistent error objects instead of throwing
  - ✅ **Good**: `catch (error) { if (isZodError(error)) return { valid: false, error: ... }; return { valid: false, error: 'Unexpected validation error' } }`
  - ❌ **Bad**: `catch (error) { if (isZodError(error)) return { valid: false, error: ... }; throw error }` (breaks callers expecting result objects)

## Related Rules
- [React Rules](../frontend/react.mdc) - React-specific patterns
- [React Hooks Rules](../frontend/react-hooks.mdc) - Hooks and data fetching patterns
- [Next.js Rules](../frontend/nextjs.mdc) - Next.js-specific patterns
